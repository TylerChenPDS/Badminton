<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="njit.dao.UserDao">

    <resultMap type="user" id="userRelRoleMap">
    	<id column="id" property="id"/>
    	<result column="stuno" property="stuno"/>
    	<result column="password" property="password"/>
    	<result column="email" property="email"/>
    	<result column="telephone" property="telephone"/>
    	<collection property="roles" select="njit.dao.UserDao.getRoleByUid" column="id">
    	</collection>
    </resultMap>
    <select id="getRoleByUid" resultType="role">
    	select 
    		r.id, r.rolename, r.rolecode,r.discount
    	from 
    		role r, user_role ur
    	where 
    		ur.rid=r.id
    		and ur.uid=#{id}
    </select>
    
    <sql id="userColum">id,stuno,password,telephone,email</sql>
    <select id="selectRelatedUsers" resultMap="userRelRoleMap">
    	select 
    		<include refid="userColum"></include>
    	from 
    		user
    </select>
    <select id="selectRelatedUser" resultMap="userRelRoleMap">
    	select 
    		<include refid="userColum"></include>
    	from 
    		user
    	where id=#{id}
    </select>
    
    
    
    
</mapper>